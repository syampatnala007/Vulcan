import React, { useState } from 'react';

const ConfigFilesDisplay = () => {
  const [selectedFolder, setSelectedFolder] = useState(null);
  const [configFiles, setConfigFiles] = useState([]);

  const handleFilePickerClick = async () => {
    try {
      const directoryHandle = await window.showDirectoryPicker();
      setSelectedFolder(directoryHandle);

      // Read files from the "config" subfolder
      const configFilesList = await readConfigFiles(directoryHandle);
      setConfigFiles(configFilesList);
    } catch (error) {
      console.error('Error accessing the selected directory:', error);
    }
  };

  const readConfigFiles = async (directoryHandle) => {
    try {
      // Get the directory handle for the "config" subfolder
      const configDirectoryHandle = await directoryHandle.getDirectoryHandle('config');

      // Get all file handles inside the "config" subfolder
      const fileHandles = await configDirectoryHandle.values();

      // Read the contents of each file using the FileReader API
      const configFilesData = await Promise.all(
        fileHandles.map(async (fileHandle) => {
          const file = await fileHandle.getFile();
          const fileContents = await readFileContents(file);
          return { name: file.name, contents: fileContents };
        })
      );

      return configFilesData;
    } catch (error) {
      console.error('Error reading config files:', error);
      return [];
    }
  };

  const readFileContents = async (file) => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => {
        resolve(reader.result);
      };
      reader.onerror = () => {
        reject(reader.error);
      };
      reader.readAsText(file);
    });
  };

  return (
    <div>
      <button onClick={handleFilePickerClick}>Select Folder</button>
      {selectedFolder && (
        <div>
          <p>Selected Folder: {selectedFolder.name}</p>
          {configFiles.length > 0 ? (
            <div>
              <h3>Config Files:</h3>
              <ul>
                {configFiles.map((file, index) => (
                  <li key={index}>
                    <strong>{file.name}</strong>
                    <pre>{file.contents}</pre>
                  </li>
                ))}
              </ul>
            </div>
          ) : (
            <p>No config files found in the "config" subfolder.</p>
          )}
        </div>
      )}
    </div>
  );
};

export default ConfigFilesDisplay;
