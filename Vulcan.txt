import React, { useState } from 'react';

const ConfigFilesDisplay = () => {
  const [selectedDirectory, setSelectedDirectory] = useState(null);
  const [configContents, setConfigContents] = useState([]);

  const handleFilePickerClick = async () => {
    try {
      const directoryHandle = await window.showDirectoryPicker();
      setSelectedDirectory(directoryHandle);

      // Read the contents of the "config" subfolder
      const configContentsList = await readConfigContents(directoryHandle);
      setConfigContents(configContentsList);
    } catch (error) {
      console.error('Error accessing the selected directory:', error);
    }
  };

  const readConfigContents = async (directoryHandle) => {
    try {
      const configContentsList = [];
      const configDirectoryHandle = await directoryHandle.getDirectoryHandle('config');
      await traverseConfigDirectory(configDirectoryHandle, configContentsList);
      return configContentsList;
    } catch (error) {
      console.error('Error reading config contents:', error);
      return [];
    }
  };

  const traverseConfigDirectory = async (configDirectoryHandle, configContentsList) => {
    for await (const entry of configDirectoryHandle.values()) {
      if (entry.kind === 'file') {
        const file = await entry.getFile();
        configContentsList.push({ type: 'file', name: file.name });
      } else if (entry.kind === 'directory') {
        const subfolderContents = [];
        await traverseConfigDirectory(entry, subfolderContents);
        configContentsList.push({ type: 'folder', name: entry.name, contents: subfolderContents });
      }
    }
  };

  const handleSubfolderClick = (subfolderContents) => {
    setConfigContents(subfolderContents);
  };

  return (
    <div>
      <button onClick={handleFilePickerClick}>Select Directory</button>
      {selectedDirectory && (
        <div>
          <p>Selected Directory: {selectedDirectory.name}/config</p>
          {configContents.length > 0 ? (
            <div>
              <h3>Contents of "config" Subfolder:</h3>
              <ul>
                {configContents.map((content, index) => (
                  <li key={index}>
                    {content.type === 'file' ? (
                      <strong>File: {content.name}</strong>
                    ) : (
                      <button onClick={() => handleSubfolderClick(content.contents)}>
                        <strong>Folder: {content.name}</strong>
                      </button>
                    )}
                  </li>
                ))}
              </ul>
            </div>
          ) : (
            <p>No contents found in the "config" subfolder.</p>
          )}
        </div>
      )}
    </div>
  );
};

export default ConfigFilesDisplay;
